from typing import List
import requests
import json
import os
from dotenv import load_dotenv

load_dotenv()


AZURE_API_KEY = os.environ.get("AZURE_API_KEY")
AZURE_ENDPOINT = os.environ.get("AZURE_ENDPOINT")
DEPLOYMENT_NAME = "text-embedding-ada-002"


def chunk_text_for_list(docs: list[str], max_chunk_size: int = 1000) -> list[list[str]]:
    """
    Break down each text in a list of texts into chunks of a maximum size, attempting to preserve whole paragraphs.

    :param docs: The list of texts to be chunked.
    :param max_chunk_size: Maximum size of each chunk in characters.
    :return: List of lists containing text chunks for each document.
    """

    def chunk_text(text: str, max_chunk_size: int) -> List[str]:
        # Ensure each text ends with a double newline to correctly split paragraphs
        if not text.endswith("\n\n"):
            text += "\n\n"
        # Split text into paragraphs
        paragraphs = text.split("\n\n")
        chunks = []
        current_chunk = ""
        # Iterate over paragraphs and assemble chunks
        for paragraph in paragraphs:
            # Check if adding the current paragraph exceeds the maximum chunk size
            if (
                len(current_chunk) + len(paragraph) + 2 > max_chunk_size
                and current_chunk
            ):
                # If so, add the current chunk to the list and start a new chunk
                chunks.append(current_chunk.strip())
                current_chunk = ""
            # Add the current paragraph to the current chunk
            current_chunk += paragraph.strip() + "\n\n"
        # Add any remaining text as the last chunk
        if current_chunk:
            chunks.append(current_chunk.strip())
        return chunks

    # Apply the chunk_text function to each document in the list
    return [chunk_text(doc, max_chunk_size) for doc in docs]


# Function to generate embeddings using Azure OpenAI
def generate_embeddings(texts):
    url = f"{AZURE_ENDPOINT}/openai/deployments/{
        DEPLOYMENT_NAME}/embeddings?api-version=2023-05-15"
    headers = {
        "Content-Type": "application/json",
        "api-key": AZURE_API_KEY,
    }

    embeddings = []
    for text in texts:
        data = {"input": text}
        response = requests.post(url, headers=headers, json=data)
        if response.status_code == 200:
            embedding = response.json()["data"][0]["embedding"]
            embeddings.append({"text": text, "embedding": embedding})
        else:
            print(f"Error: {response.status_code}, {response.text}")
    return embeddings


# Example Nepali text
nepali_texts = [
    """
    नेपाल राष्ट्र बैङ्क ऐन, २०४८
(भिति २०७४ साल पीष सतात्तसमस्म भएका संशोधन समेत मिलाइएको)

नेपाल सरकार

कानून, न्याय तथा संसदीय मामिला मन्त्रालय
सिंहदरबार
नेपाल राष्ट्र बेङ्ग ऐन, २०५८

लालमोहर र प्रकाशन मिति

२०४५८।१०१७
संशोधन गर्ने ऐन प्रमाणीकरण र प्रकाशन मिति
१. नेपाल राष्ट्र बैङ्क (पहिलो संशोधन) ऐन, २०६३” २०६३७२३
२. गणतन्त्र सुदृढीकरण तथा केही नेपाल कानून संशोधन

गर्ने ऐन, २०६६ २०६६१०।७
३. केही नेपाल ऐन संशोधन गर्ने ऐन, २०७२ २०७२१११३
४, नेपाल राष्ट्र बैङ्ग (दोस्रो संशोधन) ऐन, २०७३ २०७२७२९

२०५८ सालको ऐन नं. १५
केन्द्रीय बैङ्कको कार्य गर्न नेपाल राष्ट्र बैङ्कको स्थापना गर्न बनेको ऐन

प्रस्तावना : नेपाल छ................ को अर्थतन्त्रको “दिगो विकासमा सहयोग पुग्ने
गरी मुल्य र शोधनान्तर स्थिरता तथा समग्र वित्तीय क्षेत्रको स्थायित्व कायम गर्नको
लागि केन्द्रीय बैङ्कको रुपमा नेपाल राष्ट्र बैङ्कको स्थापना गर्न वाञ्छनीय भएकोले,

श्री ५ महाराजाधिराज ज्ञानेन्द्र वीर विक्रम शाहदेवको शासनकालको पहिलो
वर्षमा संसदले यो ऐन बनाएकोछ ।

परिच्छेद-१
प्रारम्भिक

१. संक्षिप्त नाम र प्रारम्भ : (१) यस ऐनको नाम “नेपाल राष्ट्र बैङ्क ऐन, २०५८”
रहेको छ ।

(२). यो ऐन तुरुन्त प्रारम्भ हुनेछ ।
२. परिभाषा: विषय वा प्रसङ्गले अर्को अर्थ नलागेमा यस ऐनमा,-

(क) "'बैङ्ग” भन्नाले दफा ३ बमोजिम स्थापना भएको नेपाल राष्ट्र
बैङ्क सम्झनु पर्छ ।

(ख) "समिति" भन्नाले दफा १४ बमोजिम गठन भएको बैङ्को
सञ्चालक समिति सम्झनु पर्छ ।

(ग) "सञ्चालक" भन्नाले समितिको सदस्य सम्झनु पर्छ र सो
शब्दले गभर्नर र डेपुटी गभर्नर समेतलाई जनाउँछ ।

यो ऐन २०६३ साल भाद्र २४ गते देखि प्रारम्भ भएको मानिने गरी दफा १ को उपदफा (२) मा व्यवस्था
भएको ।

१ यो ऐन संवत्‌ २०६५ साल जेठ १५ गते देखि लागू भएको ।

छ गणतन्त्र सुदृढीकरण तथा केही नेपाल कानून संशोधन गर्ने ऐन, २०६६ द्वारा झिकिएको ।

१ दोस्रो संशोधनद्वारा संशोधित ।

6)
(ज)

“गभर्नर” भन्नाले दफा १५ बमोजिम नियुक्त बैङ्कको गभर्नर
सम्झनु पर्छ ।

“डेपुटी गभर्नर” भन्नाले दफा १६ बमोजिम नियुक्त बैङ्कको
डेपुटी गभर्नर सम्झनु पर्छ ।

“वाणिज्य बैङ्ग” भन्नाले प्रचलित कानून बमोजिम स्थापना
भएको वाणिज्य बैङ्ग सम्झनु पर्छ ।

“वित्तीय संस्था" भन्नाले कृषि, सहकारी, उद्योग वा अन्य कुनै
खास आर्थिक प्रयोजनका लागि कर्जा दिने वा सर्वसाधारण
जनताबाट निक्षेप सङ्गलन गर्ने उद्देश्यले प्रचलित कानून
बमोजिम स्थापना भएको वित्तीय संस्था सम्झनु पर्छ र सो
शब्दले नेपाल सरकारले नेपाल राजपत्रमा सूचना प्रकाशन गरी
वित्तीय संस्था भनी तोकिदिएको संस्था समेतलाई जनाउँछ ।

“मुद्रा” भन्नाले सबै किसिमको करेन्सी नोट, पोस्टल अर्डर,
पोस्टल नोट, मनि अर्डर, चेक, ड्राफ्ट, ट्राभल्स चेक, प्रतीतपत्र,
विनिमयपत्र, प्रतिज्ञापत्र, क्रेडिट कार्ड सम्झनु पर्छ र सो शब्दले
बैङ्गल आवश्यकता अनुसार सार्वजनिक सूचना प्रकाशन र
प्रसारण गरी तोकिदिएको अन्य-यस्तै प्रकारका मौद्रिक उपकरण
समेतलाई जनाउँछ ।

“करेन्सी नोट” भन्नाले नगदको रुपमा चलन चल्तीमा रहेको
बैङ्ग नोट सम्झनु पर्छ र सो शब्दले सिक्का समेतलाई जनाउँछ ।

“विदेशी मुद्रा” भन्नाले नेपाली मुद्रा बाहेक अन्य मुद्रा सम्झनु
पर्छ र सो शब्दले अन्तर्राष्ट्रिय मुद्रा कोषबाट रकम झिक्ने
विशेष अधिकार (स्पेशल ड्इङ्ग राइट्स), एशियन करेन्सी युनिट,
युरोपियन करेन्सी युनिट तथा बैङ्गले आवश्यकता अनुसार
सार्वजनिक सूचना प्रकाशन र प्रसारण गरी तोकिदिएको अन्य
उपकरण समेतलाई जनाउँछ ।

“नेपाली मुद्रा” भन्नाले नेपाली रुपैयाँमा अङ्कित मुद्रा सम्झनु
पर्छ ।

“परिवर्तय विदेशी मुद्रा” भन्नाले बैङ्गल आवश्यकता अनुसार
सार्वजनिक सूचना प्रकाशन र प्रसारण गरी परिवर्तय विदेशी
मुद्रा भनी तोकिदिएको विदेशी मुद्रा सम्झनु पर्छ ।

“विदेशी विनिमय” भन्नाले विदेशी मुद्रा, विदेशी मुद्रामा भुक्तानी
हुने वा प्राप्त हुने सबै किसिमको निक्षेप, कर्जा, मौज्दात, विदेशी
धितोपत्र र विदेशी मुद्रामा भुक्तानी हुने वा हुन सक्ने अन्तर्राष्ट्रिय
प्रचलनमा रहेका चेक, ड्राफ्ट, ट्राभल्स चेक, इलेक्ट्रोनिक फण्ड
ट्रान्सफर, क्रेडिटकार्ड, प्रतीतपत्र, विनिमयपत्र, प्रतिज्ञापत्र सम्झनु
पर्छ र सो शब्दले बैङ्गले आवश्यकता अनुसार सार्वजनिक सूचना
प्रकाशन र प्रसारण गरी तोकिदिएको अन्य जुनसुकै मौद्रिक
उपकरण समेतलाई जनाउँछ ।

(२)
(ण)

(द)

पो)

“विदेशी विनिमय कारोबार” भन्नाले विदेशी विनिमय खरिद
बिक्री गर्ने, क्रण लिने, दिने वा अन्य कूनै तरिकाले विदेशी
विनिमय लिने, दिने कार्य सम्झनु पर्छ र सो शाब्दले बैङ्गले
विदेशी विनिमय सटही स्वीकृति दिने कार्य समेतलाई जनाउँछ ।

“इजाजतपत्र प्राप्त व्यक्ति” भन्नाले बैङ्कबाट विदेशी विनिमय
कारोबार गर्न इजाजतपत्र प्राप्त गरेको व्यक्ति, फर्म, कम्पनी वा
संस्था सम्झनु पर्छ ।

“प्रतीतपत्र” भन्नाले कुनै एक बैङ्कले कुनै अर्को बैङ्कको नाममा
फलानाको यति रुपैयाँले खामेसम्मको चेक ड्राफ्ट, हुण्डी वा
विनिमयपत्र स्वीकार गर्नु भनी लेखेको पत्र सम्झनु पर्छ ।

“धितोपत्र” भन्नाले कुनै सङ्गठित संस्थाले जारी गरेको शेयर,
स्टक बण्ड, डिबेन्चर, डिबेन्चर स्टक वा प्रचलित कानून
बमोजिम कुनै सङ्गठित संस्थाले जारी गरेको एकाङ्ग बचत
कार्यक्रम वा समूहगत बचत कार्यक्रम सम्बन्धी प्रमाणपत्र वा
हस्तान्तरणयोग्य निक्षेप प्रमाणपत्र सम्झनु पर्छ र सो शब्दले
नेपाल सरकारले नेपाल राजपत्रमा सूचना प्रकाशन गरी
तोकिदिएको धितोपत्र वा धितोपत्रको धरौटी सम्बन्धी भरपाई,
धितोपत्र सम्बन्धी हक र अधिकार समेतलाई जनाउँछ ।

“विनिमेय” भन्नाले विनिमेय अधिकारपत्र पाउने कुनै
व्यक्तिलाई धारक बन्न सक्ने गरी सो पत्र हस्तान्तरण गर्ने काम
सम्झनु पर्छ ।

“विनिमेय अधिकारपत्र” भन्नाले प्रतिज्ञापत्र, विनिमयपत्र वा चेक
सम्झनु पर्छ ।

“विनिमयपत्र” भन्नाले फलाना मितिमा वा यति अवधिपछि वा
मागेको बखत सो पत्रमा लेखिएको कुनै खास व्यक्तिलाई वा
निजले अहाएको व्यक्तिलाई वा सो पत्र लिई आउने व्यक्तिलाई
बिना शर्त यति रकम दिनु भनी कुनै एक व्यक्तिले अर्को
व्यक्तिलाई निर्देशन गरी दस्तखत गरिदिएको लिखत सम्झनु पर्छ ।

“प्रतिज्ञापत्र” भन्नाले फलाना मितिमा वा मागेको बखत सो
पत्रमा लेखिएको कुनै खास व्यक्तिलाई वा निजले अहाएको
व्यक्तिलाई वा सो पत्र लिई आउने व्यक्तिलाई बिना शर्त यति
रकम दिन्छु भनी कबुल गरी दस्तखत गरी दिएको लिखत
सम्झनु पर्छ ।

“चेक” भन्नाले माग्नासाथ भुक्तानी दिनु भनी कुनै बैङ्ग उपर
खिचिएको विनिमयपत्र सम्झनु पर्छ ।

“कर्जा” भन्नाले रकम लगानी गर्ने प्रत्यक्ष वा अप्रत्यक्ष
प्रतिबद्धता र त्यसको बदलामा उक्त लगानी गरेको रकम असूली
गर्ने अधिकार तथा त्यस्ता कर्जाको ब्याज वा अन्य दस्तुरको
चुक्ता, कर्जा वा लगानीको धितोमा दिइएको पुनर्कर्जा, कर्जाको

(३)
एल)

०(ल२)

पुनसंरचना र नवीकरण, कर्जा चुक्ताको लागि जारी गरेको
जमानी तथा त्यस्तो चुक्ताको लागि गरिएको अन्य बचनबद्धता
सम्झनु पर्छ र सो शब्दले कुनै पनि किसिमको क्रण समेतलाई
जनाउँछ ।

“लेखा” भन्नाले कारोबार भएको व्यहोरा देखिने गरी प्रचलित
कानून बमोजिम राखिने अभिलेख खाता तथा किताब सम्झनु
पर्छ र सो शब्दले त्यस्तो कारोबारलाई प्रमाणित गर्ने अन्य
कागजात समेतलाई जनाउँछ ।

“क्रण सुरक्षण” भन्नाले क्रणभारयुक्त कुनै पनि विनिमयपत्र
सम्झनु पर्छ र सो शब्दले बुक इन्ट्री वा प्रमाणित रुपमा रहेको
सोही सरहको अन्य कुनै क्रणभारयुक्त उपकरण समेतलाई
जनाउँछ ।

“मौद्रिक दायित्व” भन्नाले बैङ्कको वासलातमा भएको चलन
चल्तीमा रहेको बैङ्ग नोट तथा सिक्का सम्झनु पर्छ ।
“अन्तर्राष्ट्रिय लेखा मापदण्ड” भन्नाले अन्तर्राष्ट्रिय्तरको लेखा
मापदण्ड सम्झनु पर्छ ।

“कर्मचारी” भन्नाले बैङ्को कुनै पदमा बहाल रहेको व्यक्ति
सम्झनु पर्छ ।

“अदालत” भन्नाले नेपाल सरकारले सर्वोच्च अदालतको
परामर्श लिई नेपाल राजपत्रमा सूचना प्रकाशन गरी
तोकिदिएको उच्च अदालतको वाणिज्य इजलाश सम्झनु पर्छ ।

“विशेष प्रशासन समूह” भन्नाले दफा ददख, बमोजिम गठन
भएको विशेष प्रशासन समूह सम्झनु पर्छ ।

“तोकिएको” वा “तोकिए बमोजिम” भन्नाले यस ऐन अन्तर्गत
बनेको नियम वा विनियममा तोकिएको वा तोकिए बमोजिम
सम्झनु पर्छ ।

परिच्छेद-२

स्थापना, उद्देश्य तथा काम, कर्तव्य र अधिकार

बैङ्कको स्थापना

: (१) केन्द्रीय बैङ्कको कार्य गर्न नेपाल राष्ट्र बैङ्ग नामको एउटा

केन्द्रीय बैङ्क स्थापना हुनेछ ।

(२) नेपाल राष्ट्र बैङ्क ऐन, २०१२ अन्तर्गत स्थापना भएको नेपाल राष्ट्र
बैङ्क यसै ऐन अन्तर्गत स्थापना भएको मानिनेछ ।

(३) बैङ्ग
हुनेछ ।

अविच्छिन्न उत्तराधिकारवाला एक स्वशासित र सङ्गठित संस्था

(४) बैङ्गको काम कारबाहीको निमित्त आफ्नो एउटा छुट्टै छाप हुनेछ ।

छ

दोस्रो संशोधनद्वारा थप ।

(४)
""",
    "आयकर नियमहरू",
    "फैसला: कर चोरीको मुद्दा",
]

# Generate embeddings
embeddings = generate_embeddings(nepali_texts)

# Save embeddings to a text file
with open("embeddings.txt", "w", encoding="utf-8") as file:
    file.write(json.dumps(embeddings, ensure_ascii=False, indent=4))

print("Embeddings saved to embeddings.txt")
